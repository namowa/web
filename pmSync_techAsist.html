<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technician's Mobile Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .view {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .popup-enter { animation: popupEnter 0.3s ease-out; }
        @keyframes popupEnter {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .tab-button.active {
            border-bottom-color: #2563eb; /* blue-600 */
            color: #2563eb;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="max-w-md mx-auto bg-gray-100 min-h-screen shadow-lg">
        <!-- Header -->
        <header id="main-header" class="bg-white shadow-md sticky top-0 z-10">
            <div id="header-content" class="mx-auto py-3 px-4">
                <!-- Header content changes dynamically -->
            </div>
            <div id="tab-navigation" class="flex border-b border-gray-200">
                <!-- Tab buttons will be here -->
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-4">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view">
                <!-- Content generated by JS -->
            </div>
            
            <!-- Task List View -->
            <div id="task-list-view" class="view">
                <!-- Content generated by JS -->
            </div>
            
            <!-- Knowledge Base View -->
            <div id="knowledge-base-view" class="view">
                <!-- Content generated by JS -->
            </div>

            <!-- Task Detail View -->
            <div id="task-detail-view" class="view">
                <!-- Content generated by JS -->
            </div>
        </main>
        
        <!-- Modal for messages -->
        <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-6 m-4 text-center shadow-xl max-w-sm popup-enter">
                <div id="modal-icon" class="mx-auto mb-4"></div>
                <h3 id="modal-title" class="text-lg font-bold text-gray-800"></h3>
                <p id="modal-message" class="text-sm text-gray-600 mt-2"></p>
                <button onclick="closeModal()" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold w-full">ตกลง</button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data
        const currentUser = { name: 'สมชาย เก่งมาก', avatar: 'https://placehold.co/40x40/E2E8F0/475569?text=S' };
        const myTasks = [
            { id: 1, machineName: 'Main Coolant Pump', task: 'PdM: ตรวจสอบ Bearing', type: 'PdM', priority: 'Critical', status: 'New', aiInsight: 'ตรวจพบความน่าจะเป็นสูงที่ตลับลูกปืนจะเสียหาย', recommendedParts: ['Bearing #6204', 'Lubricant G-5'], knowledgeBaseId: 101, digitalTwinId: 1 },
            { id: 2, machineName: 'Conveyor Belt #2', task: 'ซ่อมสายพานเสียงดัง', type: 'Corrective', priority: 'High', status: 'New', aiInsight: 'ไม่มีข้อมูล', recommendedParts: [], knowledgeBaseId: null, digitalTwinId: 2 },
            { id: 3, machineName: 'CNC Machine #5', task: 'PM: ตรวจสอบระบบหล่อลื่น', type: 'PM', priority: 'Medium', status: 'New', aiInsight: 'ไม่มีข้อมูล', recommendedParts: ['Grease Gun', 'Cleaning Cloth'], knowledgeBaseId: 205, digitalTwinId: 3 },
        ];
        const knowledgeBase = [
            { id: 101, machineName: 'Main Coolant Pump', title: 'วิธีเปลี่ยนตลับลูกปืน #6204', solution: 'ใช้เครื่องมือดูดตลับลูกปืน, ทำความสะอาดเพลา, และใส่ตลับลูกปืนใหม่พร้อมจาระบี', keywords: ['bearing', 'pump', '6204'] },
            { id: 205, machineName: 'CNC Machine #5', title: 'ขั้นตอนการตรวจสอบระบบหล่อลื่น', solution: 'ตรวจสอบระดับน้ำมัน, เช็คการทำงานของปั๊ม, และทำความสะอาดหัวจ่ายน้ำมัน', keywords: ['cnc', 'lubrication'] },
            { id: 310, machineName: 'Conveyor Belt #2', title: 'การตั้งความตึงสายพาน', solution: 'คลายน็อตยึดมอเตอร์, ปรับสกรูตั้งความตึง, และตรวจสอบให้สายพานมีความหย่อนประมาณ 1-2 ซม.', keywords: ['conveyor', 'belt', 'tension'] }
        ];

        let currentView = 'dashboard'; // 'dashboard', 'list', 'kb', 'detail'
        let lastTabView = 'dashboard';

        const headerContent = document.getElementById('header-content');
        const tabNavigation = document.getElementById('tab-navigation');
        const allViews = document.querySelectorAll('.view');

        function switchView(viewName, itemId = null) {
            currentView = viewName;
            allViews.forEach(v => v.classList.remove('active'));
            
            const mainViews = ['dashboard', 'list', 'kb'];
            if (mainViews.includes(viewName)) {
                lastTabView = viewName;
                const viewIdMap = {
                    'dashboard': 'dashboard-view',
                    'list': 'task-list-view',
                    'kb': 'knowledge-base-view'
                };
                document.getElementById(viewIdMap[viewName]).classList.add('active');
                renderMainHeader();
                updateActiveTab();
            } else if (viewName === 'detail' && itemId) {
                document.getElementById('task-detail-view').classList.add('active');
                renderDetailHeader(itemId);
                renderTaskDetail(itemId);
            }
            window.scrollTo(0, 0);
        }

        function renderMainHeader() {
            headerContent.innerHTML = `
                <div class="flex items-center justify-between w-full">
                    <div class="flex items-center space-x-3">
                        <img src="${currentUser.avatar}" alt="User Avatar" class="w-10 h-10 rounded-full">
                        <div>
                            <p class="font-bold text-gray-800">${currentUser.name}</p>
                            <p class="text-xs text-green-600 font-semibold">Online</p>
                        </div>
                    </div>
                    <button class="text-gray-500"><i data-lucide="bell" class="h-6 w-6"></i></button>
                </div>
            `;
            tabNavigation.innerHTML = `
                <button class="tab-button flex-1 py-3 text-sm font-semibold border-b-2 border-transparent text-gray-500" onclick="switchView('dashboard')">ภาพรวม</button>
                <button class="tab-button flex-1 py-3 text-sm font-semibold border-b-2 border-transparent text-gray-500" onclick="switchView('list')">งานของฉัน</button>
                <button class="tab-button flex-1 py-3 text-sm font-semibold border-b-2 border-transparent text-gray-500" onclick="switchView('kb')">คลังความรู้</button>
            `;
            tabNavigation.style.display = 'flex';
            lucide.createIcons();
        }

        function renderDetailHeader(taskId) {
            headerContent.innerHTML = `
                <div class="flex items-center justify-center relative w-full">
                    <button onclick="switchView(lastTabView)" class="absolute left-0 text-blue-600">
                        <i data-lucide="chevron-left" class="h-6 w-6"></i>
                    </button>
                    <h1 class="text-xl font-bold text-gray-800">รายละเอียดงาน</h1>
                </div>
            `;
            tabNavigation.style.display = 'none';
            lucide.createIcons();
        }

        function updateActiveTab() {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            const activeBtn = tabNavigation.querySelector(`button[onclick="switchView('${currentView}')"]`);
            if (activeBtn) activeBtn.classList.add('active');
        }

        function getPriorityStyles(priority) {
            switch (priority) {
                case 'Critical': return { border: 'border-red-500', bg: 'bg-red-50', text: 'text-red-800' };
                case 'High': return { border: 'border-yellow-500', bg: 'bg-yellow-50', text: 'text-yellow-800' };
                default: return { border: 'border-blue-500', bg: 'bg-blue-50', text: 'text-blue-800' };
            }
        }
        
        function renderDashboard() {
            document.getElementById('dashboard-view').innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h2 class="text-gray-500 text-sm font-medium">ใบงานที่เสร็จสิ้น (เดือนนี้)</h2>
                        <p class="text-3xl font-bold text-blue-600">25</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h2 class="text-gray-500 text-sm font-medium">เสร็จตรงเวลา</h2>
                        <p class="text-3xl font-bold text-green-600">96%</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow col-span-2">
                        <h2 class="text-gray-500 text-sm font-medium">งานที่กำลังทำ / ค้างอยู่</h2>
                        <p class="text-3xl font-bold text-yellow-600">${myTasks.length}</p>
                    </div>
                </div>
                <div class="mt-6 bg-white rounded-lg shadow">
                    <h3 class="p-4 font-bold text-gray-700 border-b">งานด่วนที่ต้องทำ</h3>
                     <div class="divide-y">
                        ${myTasks.filter(t => t.priority === 'Critical' || t.priority === 'High').map(task => `
                            <div class="p-4 flex items-center justify-between cursor-pointer" onclick="switchView('detail', ${task.id})">
                                <div>
                                    <p class="font-semibold">${task.machineName}</p>
                                    <p class="text-sm text-gray-600">${task.task}</p>
                                </div>
                                <i data-lucide="chevron-right" class="h-5 w-5 text-gray-400"></i>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function renderTaskList() {
            let taskListHtml = '<div class="space-y-3">';
            taskListHtml += myTasks.map(task => {
                const styles = getPriorityStyles(task.priority);
                return `
                    <div class="bg-white rounded-lg shadow p-4 border-l-4 ${styles.border}" onclick="switchView('detail', ${task.id})">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold text-lg text-gray-800">${task.machineName}</p>
                                <p class="text-sm text-gray-600">${task.task}</p>
                            </div>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${styles.bg} ${styles.text}">${task.priority}</span>
                        </div>
                    </div>
                `;
            }).join('');
            taskListHtml += '</div>';
            document.getElementById('task-list-view').innerHTML = taskListHtml;
        }
        
        function renderKnowledgeBase() {
            const kbView = document.getElementById('knowledge-base-view');
            kbView.innerHTML = `
                <div class="relative mb-4">
                    <input type="text" placeholder="ค้นหาจากคลังความรู้..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                    <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"></i>
                </div>
                <div class="space-y-3">
                    ${knowledgeBase.map(item => `
                        <div class="bg-white rounded-lg shadow p-4">
                            <p class="font-bold text-gray-800">${item.title}</p>
                            <p class="text-sm text-gray-600 mt-1">${item.solution}</p>
                            <p class="text-xs text-gray-400 mt-2">เกี่ยวข้องกับ: ${item.machineName}</p>
                        </div>
                    `).join('')}
                </div>
            `;
            lucide.createIcons();
        }

        function renderTaskDetail(taskId) {
            const task = myTasks.find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('task-detail-view').innerHTML = `
                <div class="bg-white rounded-lg shadow p-5 space-y-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">${task.machineName}</h2>
                        <p class="text-gray-600 mt-1">${task.task}</p>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <h3 class="font-bold text-blue-800 flex items-center"><i data-lucide="sparkles" class="h-5 w-5 mr-2"></i>AI Recommendations</h3>
                        <div class="mt-2 text-sm space-y-1">
                            <p><span class="font-semibold">Insight:</span> ${task.aiInsight}</p>
                            ${task.recommendedParts.length > 0 ? `<p class="font-semibold mt-2">อะไหล่ที่แนะนำ:</p><ul class="list-disc list-inside text-blue-700">${task.recommendedParts.map(part => `<li>${part}</li>`).join('')}</ul>` : ''}
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-700 mb-2">เครื่องมือช่วยเหลือ</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="showFeatureModal('AR Assistant', 'ฟังก์ชันนี้จะเปิดกล้องเพื่อแสดงข้อมูลซ้อนทับบนเครื่องจักรจริง ช่วยนำทางขั้นตอนการซ่อม', 'camera')" class="flex items-center justify-center p-3 bg-gray-100 rounded-lg text-gray-700 font-semibold"><i data-lucide="camera" class="h-5 w-5 mr-2"></i>AR Assistant</button>
                            <button onclick="showFeatureModal('Digital Twin', 'ฟังก์ชันนี้จะแสดงโมเดล 3 มิติของเครื่องจักร พร้อมข้อมูลจากเซ็นเซอร์แบบ Real-time', 'box-select')" class="flex items-center justify-center p-3 bg-gray-100 rounded-lg text-gray-700 font-semibold"><i data-lucide="box-select" class="h-5 w-5 mr-2"></i>Digital Twin</button>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-700 mb-2">บันทึกการทำงานและอัปเดตสถานะ</h3>
                        <textarea rows="3" placeholder="เพิ่มบันทึกการทำงานที่นี่..." class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
                        <button class="mt-2 w-full flex items-center justify-center gap-2 bg-gray-200 text-gray-700 font-semibold py-2 rounded-lg"><i data-lucide="camera" class="h-4 w-4"></i>แนบรูปภาพ</button>
                        <div class="mt-4 grid grid-cols-2 gap-2">
                            <button class="bg-yellow-500 text-white font-semibold py-3 rounded-lg">เริ่มงาน</button>
                            <button class="bg-green-500 text-white font-semibold py-3 rounded-lg">ปิดงาน</button>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }
        
        const modal = document.getElementById('message-modal');
        function showFeatureModal(title, message, icon) {
            modal.querySelector('#modal-title').textContent = title;
            modal.querySelector('#modal-message').textContent = message;
            modal.querySelector('#modal-icon').innerHTML = `<i data-lucide="${icon}" class="h-12 w-12 text-blue-500"></i>`;
            modal.classList.remove('hidden');
            lucide.createIcons();
        }
        function closeModal() {
            modal.classList.add('hidden');
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard();
            renderTaskList();
            renderKnowledgeBase();
            switchView('dashboard');
        });
    </script>
</body>
</html>
