<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technician's Mobile Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Sarabun', 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .view {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .popup-enter { animation: popupEnter 0.3s ease-out; }
        @keyframes popupEnter {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="app" class="max-w-md mx-auto bg-gray-100 min-h-screen shadow-lg">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-10">
            <div id="header-content" class="mx-auto py-4 px-4 flex items-center justify-center relative">
                <!-- Header content changes dynamically -->
            </div>
        </header>

        <!-- Main Content -->
        <main class="p-4">
            <!-- Task List View -->
            <div id="task-list-view" class="view active">
                <!-- Content generated by JS -->
            </div>

            <!-- Task Detail View -->
            <div id="task-detail-view" class="view">
                <!-- Content generated by JS -->
            </div>
        </main>
        
        <!-- Modal for messages -->
        <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-lg p-6 m-4 text-center shadow-xl max-w-sm popup-enter">
                <div id="modal-icon" class="mx-auto mb-4"></div>
                <h3 id="modal-title" class="text-lg font-bold text-gray-800"></h3>
                <p id="modal-message" class="text-sm text-gray-600 mt-2"></p>
                <button onclick="closeModal()" class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold w-full">ตกลง</button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data for Technician's Assigned Tasks
        const myTasks = [
            { id: 1, machineName: 'Main Coolant Pump', task: 'PdM: ตรวจสอบ Bearing', type: 'PdM', priority: 'Critical', status: 'New', aiInsight: 'ตรวจพบความน่าจะเป็นสูงที่ตลับลูกปืนจะเสียหาย', recommendedParts: ['Bearing #6204', 'Lubricant G-5'], knowledgeBaseId: 101, digitalTwinId: 1 },
            { id: 2, machineName: 'Conveyor Belt #2', task: 'ซ่อมสายพานเสียงดัง', type: 'Corrective', priority: 'High', status: 'New', aiInsight: 'ไม่มีข้อมูล', recommendedParts: [], knowledgeBaseId: null, digitalTwinId: 2 },
            { id: 3, machineName: 'CNC Machine #5', task: 'PM: ตรวจสอบระบบหล่อลื่น', type: 'PM', priority: 'Medium', status: 'New', aiInsight: 'ไม่มีข้อมูล', recommendedParts: ['Grease Gun', 'Cleaning Cloth'], knowledgeBaseId: 205, digitalTwinId: 3 },
        ];

        const headerContent = document.getElementById('header-content');
        const taskListView = document.getElementById('task-list-view');
        const taskDetailView = document.getElementById('task-detail-view');
        
        function switchView(viewName, taskId = null) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            if (viewName === 'list') {
                document.getElementById('task-list-view').classList.add('active');
                renderHeader('list');
                renderTaskList();
            } else if (viewName === 'detail' && taskId) {
                document.getElementById('task-detail-view').classList.add('active');
                renderHeader('detail', taskId);
                renderTaskDetail(taskId);
            }
            window.scrollTo(0, 0);
        }

        function renderHeader(viewName, taskId = null) {
            if (viewName === 'list') {
                headerContent.innerHTML = `<h1 class="text-xl font-bold text-gray-800">งานของฉัน (3)</h1>`;
            } else if (viewName === 'detail') {
                const task = myTasks.find(t => t.id === taskId);
                headerContent.innerHTML = `
                    <button onclick="switchView('list')" class="absolute left-4 text-blue-600">
                        <i data-lucide="chevron-left" class="h-6 w-6"></i>
                    </button>
                    <h1 class="text-xl font-bold text-gray-800">รายละเอียดงาน</h1>
                `;
            }
            lucide.createIcons();
        }

        function getPriorityStyles(priority) {
            switch (priority) {
                case 'Critical': return 'border-red-500 bg-red-50 text-red-800';
                case 'High': return 'border-yellow-500 bg-yellow-50 text-yellow-800';
                default: return 'border-blue-500 bg-blue-50 text-blue-800';
            }
        }

        function renderTaskList() {
            taskListView.innerHTML = myTasks.map(task => {
                const priorityStyles = getPriorityStyles(task.priority);
                return `
                    <div class="bg-white rounded-lg shadow p-4 mb-3 border-l-4 ${priorityStyles}" onclick="switchView('detail', ${task.id})">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold text-lg text-gray-800">${task.machineName}</p>
                                <p class="text-sm text-gray-600">${task.task}</p>
                            </div>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${priorityStyles}">${task.priority}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderTaskDetail(taskId) {
            const task = myTasks.find(t => t.id === taskId);
            if (!task) return;

            taskDetailView.innerHTML = `
                <div class="bg-white rounded-lg shadow p-5 space-y-6">
                    <!-- Task Info -->
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">${task.machineName}</h2>
                        <p class="text-gray-600 mt-1">${task.task}</p>
                    </div>

                    <!-- AI Recommendations -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                        <h3 class="font-bold text-blue-800 flex items-center"><i data-lucide="sparkles" class="h-5 w-5 mr-2"></i>AI Recommendations</h3>
                        <div class="mt-2 text-sm space-y-1">
                            <p><span class="font-semibold">Insight:</span> ${task.aiInsight}</p>
                            ${task.recommendedParts.length > 0 ? `<p class="font-semibold mt-2">อะไหล่ที่แนะนำ:</p><ul class="list-disc list-inside text-blue-700">${task.recommendedParts.map(part => `<li>${part}</li>`).join('')}</ul>` : ''}
                        </div>
                    </div>

                    <!-- Advanced Tools -->
                    <div>
                        <h3 class="font-bold text-gray-700 mb-2">เครื่องมือช่วยเหลือ</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="showFeatureModal('AR Assistant', 'ฟังก์ชันนี้จะเปิดกล้องเพื่อแสดงข้อมูลซ้อนทับบนเครื่องจักรจริง ช่วยนำทางขั้นตอนการซ่อม', 'camera')" class="flex items-center justify-center p-3 bg-gray-100 rounded-lg text-gray-700 font-semibold"><i data-lucide="camera" class="h-5 w-5 mr-2"></i>AR Assistant</button>
                            <button onclick="showFeatureModal('Digital Twin', 'ฟังก์ชันนี้จะแสดงโมเดล 3 มิติของเครื่องจักร พร้อมข้อมูลจากเซ็นเซอร์แบบ Real-time', 'box-select')" class="flex items-center justify-center p-3 bg-gray-100 rounded-lg text-gray-700 font-semibold"><i data-lucide="box-select" class="h-5 w-5 mr-2"></i>Digital Twin</button>
                        </div>
                    </div>
                    
                    <!-- Knowledge Base -->
                    <div>
                        <h3 class="font-bold text-gray-700 mb-2">ค้นหาจากฐานข้อมูล (Knowledge Base)</h3>
                        <div class="relative">
                            <input type="text" placeholder="ค้นหาเคสซ่อมที่คล้ายกัน..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                            <i data-lucide="search" class="absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"></i>
                        </div>
                    </div>

                    <!-- Work Log & Status Update -->
                    <div>
                        <h3 class="font-bold text-gray-700 mb-2">บันทึกการทำงานและอัปเดตสถานะ</h3>
                        <textarea rows="3" placeholder="เพิ่มบันทึกการทำงานที่นี่..." class="w-full px-3 py-2 border border-gray-300 rounded-lg"></textarea>
                        <button class="mt-2 w-full flex items-center justify-center gap-2 bg-gray-200 text-gray-700 font-semibold py-2 rounded-lg"><i data-lucide="camera" class="h-4 w-4"></i>แนบรูปภาพ</button>
                        <div class="mt-4 grid grid-cols-2 gap-2">
                            <button class="bg-yellow-500 text-white font-semibold py-3 rounded-lg">เริ่มงาน</button>
                            <button class="bg-green-500 text-white font-semibold py-3 rounded-lg">ปิดงาน</button>
                        </div>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }
        
        const modal = document.getElementById('message-modal');
        function showFeatureModal(title, message, icon) {
            modal.querySelector('#modal-title').textContent = title;
            modal.querySelector('#modal-message').textContent = message;
            modal.querySelector('#modal-icon').innerHTML = `<i data-lucide="${icon}" class="h-12 w-12 text-blue-500"></i>`;
            modal.classList.remove('hidden');
            lucide.createIcons();
        }
        function closeModal() {
            modal.classList.add('hidden');
        }

        // Initial Load
        document.addEventListener('DOMContentLoaded', () => {
            switchView('list');
        });
    </script>
</body>
</html>
