<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Logger - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (LIFF)</title>
    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', 'Inter', sans-serif; }
        h1, h2, h3, button, label { font-family: 'Sarabun', 'Inter', sans-serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in-row { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <!-- Main Application Card -->
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-10 mb-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-slate-800">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ üèãÔ∏è‚Äç‚ôÄÔ∏è</h1>
                <p id="liff-greeting" class="text-slate-500 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE...</p>
            </div>

            <!-- Form -->
            <form id="workoutForm" class="space-y-6">
                <div class="grid md:grid-cols-2 gap-6">
                     <div>
                        <label for="liffId" class="block text-sm font-bold text-slate-700 mb-2">
                            LIFF ID <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="liffId" name="liffId" placeholder="‡∏ß‡∏≤‡∏á LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" value="1654435774-DazrMVl1"
                               class="w-full p-3 bg-slate-200 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" required readonly>
                    </div>
                    <div>
                        <label for="scriptUrl" class="block text-sm font-bold text-slate-700 mb-2">
                            Google Apps Script URL <span class="text-red-500">*</span>
                        </label>
                        <input type="url" id="scriptUrl" name="scriptUrl" placeholder="‡∏ß‡∏≤‡∏á Web App URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà"
                               class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label for="exerciseType" class="block text-sm font-bold text-slate-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ <span class="text-red-500">*</span></label>
                        <input type="text" id="exerciseType" name="exerciseType" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏¥‡πà‡∏á, ‡πÄ‡∏ß‡∏ó‡πÄ‡∏ó‡∏£‡∏ô‡∏ô‡∏¥‡πà‡∏á" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg" required>
                    </div>
                    <div>
                        <label for="duration" class="block text-sm font-bold text-slate-700 mb-2">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ) <span class="text-red-500">*</span></label>
                        <input type="number" id="duration" name="duration" placeholder="‡πÄ‡∏ä‡πà‡∏ô 30" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg" required>
                    </div>
                </div>

                <div>
                    <label for="exerciseDate" class="block text-sm font-bold text-slate-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</label>
                    <input type="date" id="exerciseDate" name="exerciseDate" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg">
                </div>

                <div>
                    <label for="notes" class="block text-sm font-bold text-slate-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                    <textarea id="notes" name="notes" rows="4" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°" class="w-full p-3 bg-slate-50 border border-slate-300 rounded-lg"></textarea>
                </div>

                <div class="flex flex-col sm:flex-row gap-4">
                    <button type="submit" id="submitButton" class="w-full sm:w-1/2 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-transform transform hover:scale-105" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button type="button" id="loadHistoryButton" class="w-full sm:w-1/2 bg-slate-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-slate-700 transition-transform transform hover:scale-105" disabled>‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
                </div>
            </form>
            
            <div id="statusMessage" class="mt-6 text-center text-sm font-medium"></div>
        </div>

        <!-- History Data Section -->
        <div id="historySection" class="bg-white rounded-2xl shadow-xl p-6 md:p-10 mb-8 hidden">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h2>
            <div id="historyLoader" class="text-center p-4 hidden">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200">
                    <thead class="bg-slate-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡∏ô‡∏≤‡∏ó‡∏µ)</th>
                            <th class="px-6 py-3 text-left text-xs font-bold text-slate-500 uppercase tracking-wider">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody" class="bg-white divide-y divide-slate-200"></tbody>
                </table>
                 <p id="noHistoryMessage" class="text-center text-slate-500 p-6 hidden">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            </div>
        </div>

        <!-- Instructions Card -->
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-10">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)</h2>
            <div class="space-y-6 text-slate-600">
                <div>
                    <h3 class="font-bold text-lg mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF ‡πÉ‡∏ô LINE Developers</h3>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà <a href="https://developers.line.biz/" target="_blank" class="text-blue-600 hover:underline">LINE Developers Console</a> ‡πÅ‡∏•‡∏∞ Login.</li>
                        <li>‡∏™‡∏£‡πâ‡∏≤‡∏á Provider (‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ) ‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì.</li>
                        <li>‡πÉ‡∏ô Provider, ‡∏™‡∏£‡πâ‡∏≤‡∏á Channel ‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏õ‡πá‡∏ô **"LINE Login"**.</li>
                        <li>‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö **"LIFF"** ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å **"Add"**.</li>
                        <li>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LIFF App:
                            <ul class="list-disc list-inside ml-4 mt-2">
                                <li>**LIFF app name:** ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÄ‡∏ä‡πà‡∏ô Workout Logger).</li>
                                <li>**Size:** ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Full, Tall, ‡∏´‡∏£‡∏∑‡∏≠ Compact. (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Full).</li>
                                <li>**Endpoint URL:** ‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÇ‡∏Æ‡∏™‡∏ï‡πå‡πÑ‡∏ü‡∏•‡πå HTML ‡∏ô‡∏µ‡πâ (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å).</li>
                                <li>**Scopes:** **‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô `profile` ‡πÅ‡∏•‡∏∞ `openid` (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)**.</li>
                                <li>**Scan QR:** ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡∏Å‡πá‡πÑ‡∏î‡πâ (Optional).</li>
                            </ul>
                        </li>
                        <li>‡∏Å‡∏î **"Add"** ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á LIFF App ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì. **‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å "LIFF ID"** ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô.</li>
                    </ol>
                </div>
                <div>
                    <h3 class="font-bold text-lg mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheet ‡πÅ‡∏•‡∏∞ Apps Script</h3>
                     <p class="text-sm bg-yellow-100 text-yellow-800 p-3 rounded-lg mb-4"><b>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</b> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô Sheet ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li><b>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Google Sheet:</b> ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ (‡πÄ‡∏û‡∏¥‡πà‡∏° 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà): <br>
                            <code class="bg-slate-200 p-1 rounded">Timestamp</code>, <code class="bg-slate-200 p-1 rounded">Date</code>, <code class="bg-slate-200 p-1 rounded">ExerciseType</code>, <code class="bg-slate-200 p-1 rounded">Duration</code>, <code class="bg-slate-200 p-1 rounded">Notes</code>, <code class="bg-slate-200 p-1 rounded text-blue-700 font-bold">UserID</code>, <code class="bg-slate-200 p-1 rounded text-blue-700 font-bold">DisplayName</code>
                        </li>
                        <li><b>‡πÄ‡∏õ‡∏¥‡∏î Apps Script:</b> ‡πÑ‡∏õ‡∏ó‡∏µ‡πà <code class="bg-slate-200 p-1 rounded">Extensions</code> &rarr; <code class="bg-slate-200 p-1 rounded">Apps Script</code>.</li>
                        <li><b>‡πÉ‡∏™‡πà‡πÇ‡∏Ñ‡πâ‡∏î:</b> ‡∏•‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LIFF ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å.</li>
                        <li><b>Deploy ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà:</b> ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô Deploy ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥ (Deploy &rarr; Manage deployments &rarr; Edit &rarr; New version &rarr; Deploy). **URL ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°**.</li>
                        <li><b>‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</b> ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏≠‡∏Å LIFF ID ‡πÅ‡∏•‡∏∞ Script URL ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢.</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables to store user profile
        let userProfile = { userId: null, displayName: null };

        // DOM Elements
        const form = document.getElementById('workoutForm');
        const statusMessage = document.getElementById('statusMessage');
        const submitButton = document.getElementById('submitButton');
        const loadHistoryButton = document.getElementById('loadHistoryButton');
        const historySection = document.getElementById('historySection');
        const historyTableBody = document.getElementById('historyTableBody');
        const historyLoader = document.getElementById('historyLoader');
        const noHistoryMessage = document.getElementById('noHistoryMessage');
        const liffGreeting = document.getElementById('liff-greeting');
        const liffIdInput = document.getElementById('liffId');

        async function initializeLiff() {
            const liffId = liffIdInput.value;
            if (!liffId) {
                liffGreeting.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å LIFF ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                return;
            }
            
            try {
                await liff.init({ liffId: liffId });
                
                if (!liff.isLoggedIn()) {
                    liffGreeting.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                    // To auto-login, this app should be opened from within the LINE app.
                    // You can also uncomment the next line to force login for testing in a browser.
                    // liff.login(); 
                } else {
                    const profile = await liff.getProfile();
                    userProfile.userId = profile.userId;
                    userProfile.displayName = profile.displayName;
                    
                    liffGreeting.innerHTML = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, <span class="font-bold text-blue-600">${userProfile.displayName}</span>! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏£‡∏∂‡∏¢‡∏±‡∏á?`;
                    submitButton.disabled = false;
                    loadHistoryButton.disabled = false;
                }
            } catch (error) {
                console.error('LIFF Initialization failed', error);
                liffGreeting.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE ‡πÑ‡∏î‡πâ';
                statusMessage.innerHTML = `<span class="text-red-500">LIFF Init Error: ${error.message}</span>`;
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('exerciseDate').valueAsDate = new Date();
             // Automatically initialize LIFF on page load since the ID is pre-filled
             initializeLiff();
        });

        // Handle form submission
        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const scriptUrl = document.getElementById('scriptUrl').value;
            if (!scriptUrl || !userProfile.userId) {
                statusMessage.innerHTML = `<span class="text-red-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LIFF ‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏Å Script URL ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</span>`;
                return;
            }
            
            submitButton.disabled = true;
            submitButton.innerHTML = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...`;
            statusMessage.textContent = '';
            
            const formData = { 
                date: document.getElementById('exerciseDate').value, 
                exerciseType: document.getElementById('exerciseType').value, 
                duration: document.getElementById('duration').value, 
                notes: document.getElementById('notes').value,
                userId: userProfile.userId,
                displayName: userProfile.displayName
            };

            try {
                await fetch(scriptUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify(formData) });
                statusMessage.innerHTML = `<span class="text-green-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! üéâ</span>`;
                form.reset();
                document.getElementById('scriptUrl').value = scriptUrl;
                document.getElementById('liffId').value = liffIdInput.value; // Keep the liff id
                document.getElementById('exerciseDate').valueAsDate = new Date();
            } catch (error) {
                statusMessage.innerHTML = `<span class="text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}.</span>`;
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            }
        });

        // Handle loading history
        loadHistoryButton.addEventListener('click', async () => {
            const scriptUrl = document.getElementById('scriptUrl').value;
            if (!scriptUrl) {
                statusMessage.innerHTML = `<span class="text-red-500">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Web App URL ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>`;
                return;
            }
            historySection.classList.remove('hidden');
            historyLoader.classList.remove('hidden');
            historyTableBody.innerHTML = '';
            noHistoryMessage.classList.add('hidden');
            
            try {
                const response = await fetch(scriptUrl);
                const data = await response.json();
                historyLoader.classList.add('hidden');

                if (data.length === 0) {
                    noHistoryMessage.classList.remove('hidden');
                } else {
                    data.forEach((row, index) => {
                        const tr = document.createElement('tr');
                        tr.className = 'fade-in-row';
                        tr.style.animationDelay = `${index * 50}ms`;
                        const formattedDate = row.date ? new Date(row.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A';
                        
                        tr.innerHTML = `
                            <td class="px-6 py-4 text-sm text-slate-800">${formattedDate}</td>
                            <td class="px-6 py-4 text-sm font-medium text-slate-900">${row.displayName}</td>
                            <td class="px-6 py-4 text-sm text-slate-800">${row.exerciseType}</td>
                            <td class="px-6 py-4 text-sm text-slate-800">${row.duration}</td>
                            <td class="px-6 py-4 text-sm text-slate-500">${row.notes}</td>
                        `;
                        historyTableBody.appendChild(tr);
                    });
                }
            } catch (error) {
                historyLoader.classList.add('hidden');
                statusMessage.innerHTML = `<span class="text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${error.message}.</span>`;
            }
        });
    </script>
</body>
</html>
